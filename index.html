<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseball Card Collection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2em;
            margin-top: 50px;
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px auto;
            max-width: 600px;
        }

        .stats-bar {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stat {
            text-align: center;
            padding: 10px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .collection-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .collection-section h2 {
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .filters {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-input {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card-item {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            position: relative;
            transition: all 0.3s;
        }

        .card-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .card-player {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        .card-badges {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 5px;
        }

        .badge {
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .badge.auto {
            background: #28a745;
        }

        .badge.relic {
            background: #dc3545;
        }

        .badge.numbered {
            background: #ffc107;
            color: #333;
        }

        .card-details {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .card-detail {
            margin: 3px 0;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .update-info {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            font-size: 0.9em;
            color: #666;
        }

        .last-updated {
            color: #667eea;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öæ Baseball Card Collection</h1>
        
        <div id="loading" class="loading">Loading collection...</div>
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="content" style="display: none;">
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-number" id="totalCards">0</div>
                    <div class="stat-label">Total Cards</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="uniquePlayers">0</div>
                    <div class="stat-label">Unique Players</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="totalAutos">0</div>
                    <div class="stat-label">Autographs</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="totalRelics">0</div>
                    <div class="stat-label">Relics</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="totalValue">$0</div>
                    <div class="stat-label">Est. Total Value</div>
                </div>
            </div>

            <div class="collection-section">
                <h2>Collection</h2>
                
                <div class="filters">
                    <input type="text" id="searchFilter" placeholder="Search players, teams, years, products..." class="filter-input">
                    <select id="productFilter" class="filter-input">
                        <option value="">All Products</option>
                    </select>
                    <select id="typeFilter" class="filter-input">
                        <option value="">All Types</option>
                        <option value="auto">Autographs</option>
                        <option value="relic">Relics</option>
                        <option value="numbered">Numbered</option>
                        <option value="base">Base Cards</option>
                    </select>
                    <select id="sortBy" class="filter-input">
                        <option value="newest">Newest Added</option>
                        <option value="oldest">Oldest Added</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="player">Player Name A-Z</option>
                        <option value="year-new">Year: Newest</option>
                        <option value="year-old">Year: Oldest</option>
                    </select>
                </div>

                <div id="cardsList" class="cards-grid"></div>
                
                <div class="update-info">
                    <div class="last-updated" id="lastUpdated"></div>
                    <div style="margin-top: 10px;">
                        This collection is read-only. To update, export your local collection and upload the JSON file to GitHub.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let collection = [];

        // Filter elements
        const searchFilter = document.getElementById('searchFilter');
        const productFilter = document.getElementById('productFilter');
        const typeFilter = document.getElementById('typeFilter');
        const sortBy = document.getElementById('sortBy');

        // Add event listeners
        searchFilter.addEventListener('input', renderCards);
        productFilter.addEventListener('change', renderCards);
        typeFilter.addEventListener('change', renderCards);
        sortBy.addEventListener('change', renderCards);

        // Load collection from collection.json
        async function loadCollection() {
            try {
                // Try to load from collection.json in the same directory
                const response = await fetch('./collection.json', {
                    cache: 'no-cache' // Always get fresh data
                });
                
                if (!response.ok) {
                    throw new Error('Collection file not found');
                }
                
                collection = await response.json();
                
                // Hide loading, show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
                // Set last updated time
                const now = new Date().toLocaleString();
                document.getElementById('lastUpdated').textContent = `Collection loaded at: ${now}`;
                
                // Initialize the display
                updateStats();
                updateProductFilter();
                renderCards();
                
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').innerHTML = `
                    <h3>Unable to load collection</h3>
                    <p>${error.message}</p>
                    <p style="margin-top: 10px;">Make sure collection.json is uploaded to your GitHub repository.</p>
                `;
            }
        }

        function renderCards() {
            const container = document.getElementById('cardsList');
            let filteredCards = [...collection];

            // Apply filters
            const searchTerm = searchFilter.value.toLowerCase();
            const productTerm = productFilter.value;
            const typeTerm = typeFilter.value;
            const sortTerm = sortBy.value;

            filteredCards = filteredCards.filter(card => {
                const matchesSearch = card.playerName.toLowerCase().includes(searchTerm) ||
                                     (card.team && card.team.toLowerCase().includes(searchTerm)) ||
                                     card.product.toLowerCase().includes(searchTerm) ||
                                     card.year.toString().includes(searchTerm);
                const matchesProduct = !productTerm || card.product === productTerm;
                
                let matchesType = true;
                if (typeTerm === 'auto') matchesType = card.isAuto;
                else if (typeTerm === 'relic') matchesType = card.isRelic;
                else if (typeTerm === 'numbered') matchesType = card.serialNumber;
                else if (typeTerm === 'base') matchesType = !card.isAuto && !card.isRelic && !card.serialNumber;

                return matchesSearch && matchesProduct && matchesType;
            });

            // Apply sorting
            filteredCards.sort((a, b) => {
                switch(sortTerm) {
                    case 'price-high':
                        return (b.value || 0) - (a.value || 0);
                    case 'price-low':
                        return (a.value || 0) - (b.value || 0);
                    case 'player':
                        return a.playerName.localeCompare(b.playerName);
                    case 'year-new':
                        return b.year - a.year;
                    case 'year-old':
                        return a.year - b.year;
                    case 'oldest':
                        return new Date(a.dateAdded || 0) - new Date(b.dateAdded || 0);
                    case 'newest':
                    default:
                        return new Date(b.dateAdded || 0) - new Date(a.dateAdded || 0);
                }
            });

            if (filteredCards.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>No cards match your filters.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredCards.map((card) => {
                const badges = [];
                if (card.isAuto) badges.push('<span class="badge auto">AUTO</span>');
                if (card.isRelic) badges.push('<span class="badge relic">RELIC</span>');
                if (card.serialNumber) badges.push(`<span class="badge numbered">${card.serialNumber}</span>`);

                return `
                    <div class="card-item">
                        <div class="card-header">
                            <div>
                                <div class="card-player">${card.playerName}</div>
                                <div class="card-badges">${badges.join(' ')}</div>
                            </div>
                        </div>
                        <div class="card-details">
                            <div class="card-detail"><strong>${card.year} ${card.product}</strong></div>
                            ${card.cardNumber ? `<div class="card-detail">Card #${card.cardNumber}</div>` : ''}
                            ${card.parallel ? `<div class="card-detail">üì± ${card.parallel}</div>` : ''}
                            ${card.team ? `<div class="card-detail">üèüÔ∏è ${card.team}</div>` : ''}
                            ${card.grade ? `<div class="card-detail">üìä ${card.grade}</div>` : ''}
                            ${card.value ? `<div class="card-detail">üíµ $${card.value.toFixed(2)}</div>` : ''}
                            ${card.notes ? `<div class="card-detail" style="font-style: italic;">üìù ${card.notes}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStats() {
            const totalCards = collection.length;
            const uniquePlayers = new Set(collection.map(c => c.playerName)).size;
            const totalAutos = collection.filter(c => c.isAuto).length;
            const totalRelics = collection.filter(c => c.isRelic).length;
            const totalValue = collection.reduce((sum, c) => sum + (c.value || 0), 0);

            document.getElementById('totalCards').textContent = totalCards;
            document.getElementById('uniquePlayers').textContent = uniquePlayers;
            document.getElementById('totalAutos').textContent = totalAutos;
            document.getElementById('totalRelics').textContent = totalRelics;
            document.getElementById('totalValue').textContent = `$${totalValue.toFixed(2)}`;
        }

        function updateProductFilter() {
            const products = [...new Set(collection.map(c => c.product))].sort();
            productFilter.innerHTML = '<option value="">All Products</option>';
            products.forEach(product => {
                productFilter.innerHTML += `<option value="${product}">${product}</option>`;
            });
        }

        // Load collection when page loads
        loadCollection();

        // Reload collection every 30 seconds to check for updates
        setInterval(loadCollection, 30000);
    </script>
</body>
</html>
